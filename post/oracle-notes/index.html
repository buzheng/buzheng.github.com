<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>oracle 学习笔记 | 不争笔记 </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.55.5" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="oracle 学习笔记" />
<meta property="og:description" content="常用命令  lsnrctl status 查看监听状态 lsnrctl start 启动监听 lsnrcrl stop 停止监听 sqlplus &ldquo;/as sysdba&rdquo; 以管理员身份进入命令行  startup 启动数据库实例 shutdown immediate 立刻关闭数据库    oracle启动步骤  启动侦听 lsnrctl start 启动数据库实例  [oracle@linux001 ~]$ sqlplus &quot;/as sysdba&quot; SQL*Plus: Release 11.2.0.1.0 Production on Tue Dec 16 13:50:41 2014 Copyright (c) 1982, 2009, Oracle. All rights reserved. Connected to: Oracle Database 11g Release 11.2.0.1.0 - 64bit Production SQL&gt; startup ORA-01081: cannot start already-running ORACLE - shut it down first SQL&gt; shutdown immediate Database closed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/oracle-notes/" />
<meta property="article:published_time" content="2015-04-06T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2015-04-06T00:00:00&#43;00:00"/>

<meta itemprop="name" content="oracle 学习笔记">
<meta itemprop="description" content="常用命令  lsnrctl status 查看监听状态 lsnrctl start 启动监听 lsnrcrl stop 停止监听 sqlplus &ldquo;/as sysdba&rdquo; 以管理员身份进入命令行  startup 启动数据库实例 shutdown immediate 立刻关闭数据库    oracle启动步骤  启动侦听 lsnrctl start 启动数据库实例  [oracle@linux001 ~]$ sqlplus &quot;/as sysdba&quot; SQL*Plus: Release 11.2.0.1.0 Production on Tue Dec 16 13:50:41 2014 Copyright (c) 1982, 2009, Oracle. All rights reserved. Connected to: Oracle Database 11g Release 11.2.0.1.0 - 64bit Production SQL&gt; startup ORA-01081: cannot start already-running ORACLE - shut it down first SQL&gt; shutdown immediate Database closed.">


<meta itemprop="datePublished" content="2015-04-06T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2015-04-06T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="349">



<meta itemprop="keywords" content="Oracle," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="oracle 学习笔记"/>
<meta name="twitter:description" content="常用命令  lsnrctl status 查看监听状态 lsnrctl start 启动监听 lsnrcrl stop 停止监听 sqlplus &ldquo;/as sysdba&rdquo; 以管理员身份进入命令行  startup 启动数据库实例 shutdown immediate 立刻关闭数据库    oracle启动步骤  启动侦听 lsnrctl start 启动数据库实例  [oracle@linux001 ~]$ sqlplus &quot;/as sysdba&quot; SQL*Plus: Release 11.2.0.1.0 Production on Tue Dec 16 13:50:41 2014 Copyright (c) 1982, 2009, Oracle. All rights reserved. Connected to: Oracle Database 11g Release 11.2.0.1.0 - 64bit Production SQL&gt; startup ORA-01081: cannot start already-running ORACLE - shut it down first SQL&gt; shutdown immediate Database closed."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      不争笔记
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/babylonjs/" title="BabylonJS 教程 page">
              BabylonJS 教程
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/linux/" title="Linux 教程 page">
              Linux 教程
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="博文 page">
              博文
            </a>
          </li>
          
        </ul>
      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        博文
      </p>
      <h1 class="f1 athelas mb1">oracle 学习笔记</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2015-04-06T00:00:00Z">April 6, 2015</time>      
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<h2 id="常用命令">常用命令</h2>

<ul>
<li>lsnrctl status 查看监听状态</li>
<li>lsnrctl start  启动监听</li>
<li>lsnrcrl stop   停止监听</li>
<li>sqlplus &ldquo;/as sysdba&rdquo; 以管理员身份进入命令行

<ul>
<li>startup 启动数据库实例</li>
<li>shutdown immediate 立刻关闭数据库
<br /></li>
</ul></li>
</ul>

<!-- more -->

<h2 id="oracle启动步骤">oracle启动步骤</h2>

<ol>
<li>启动侦听 lsnrctl start</li>
<li>启动数据库实例</li>
</ol>

<pre><code class="language-bash">[oracle@linux001 ~]$ sqlplus &quot;/as sysdba&quot;

SQL*Plus: Release 11.2.0.1.0 Production on Tue Dec 16 13:50:41 2014

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Release 11.2.0.1.0 - 64bit Production

SQL&gt; startup
ORA-01081: cannot start already-running ORACLE - shut it down first
SQL&gt; shutdown immediate
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL&gt; 
SQL&gt; 
SQL&gt; 
SQL&gt; 
SQL&gt; startup
ORACLE instance started.

Total System Global Area  972898304 bytes
Fixed Size                  2219272 bytes
Variable Size             285213432 bytes
Database Buffers          679477248 bytes
Redo Buffers                5988352 bytes
Database mounted.
Database opened.
SQL&gt; 
</code></pre>

<h2 id="连接oracle时-建立连接很慢">连接Oracle时，建立连接很慢</h2>

<p>表现为客户端连接 Oracle 时，建立连接时很慢，约耗时10-30秒，建立连接后，查询很快。这个主要是由于服务器主机配置了DNS解析导致的，去掉DNS后连接正常。</p>

<pre><code class="language-bash">[root@linux001 ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
TYPE=Ethernet
UUID=1407a1c8-3705-435c-8580-4e1ab2b6131e
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=yes
IPV6INIT=no
NAME=&quot;System eth0&quot;
IPADDR=192.168.1.20
PREFIX=24
GATEWAY=192.168.1.1
#DNS1=192.168.1.1
HWADDR=00:E0:4C:19:CF:79
LAST_CONNECT=1418632757
</code></pre>

<h2 id="用户-表空间-权限相关">用户、表空间、权限相关</h2>

<p><strong>创建用户</strong></p>

<pre><code class="language-sql">- create user username identified by password; 
</code></pre>

<p><strong>创建表空间</strong></p>

<pre><code class="language-sql">create tablespace tablespace_name logging datefile 'd:\oracle\tablespace\tabespace_name.dbf' size 40m autoextend on next 40m maxsize unlimited default storage (initial 40m next 40m pct increase 10); 
</code></pre>

<p><strong>分配表空间给用户</strong></p>

<pre><code class="language-sql">alert user username default tablespace tablespace_name; 
</code></pre>

<p><strong>授权</strong></p>

<pre><code class="language-sql">grant create session, create table, create view, unlimited tablespace to username; 
</code></pre>

<p><strong><code>grant connect, resource to username</code> 的含义</strong>
- connect 是连接权限
- resource 包括
  - CREATE   CLUSTER
  - CREATE   INDEXTYPE
  - CREATE   OPERATOR
  - CREATE   PROCEDURE
  - CREATE   SEQUENCE
  - CREATE   TABLE
  - CREATE   TRIGGER
  - CREATE   TYPE</p>

<p><strong>调试存储过程权限</strong></p>

<pre><code class="language-sql">GRANT debug any procedure, debug connect session TO username;
</code></pre>

<h2 id="查杀死锁会话">查杀死锁会话</h2>

<pre><code class="language-sql">SELECT OBJECT_NAME AS 对象名称,S.SID,S.SERIAL#,P.SPID AS 系统截程号 , s.USERNAME
FROM V$LOCKED_OBJECT L , DBA_OBJECTS O , V$SESSION S , V$PROCESS P  
WHERE L.OBJECT_ID=O.OBJECT_ID AND L.SESSION_ID=S.SID AND S.PADDR=P.ADDR; 
</code></pre>

<pre><code class="language-sql">-- 查看被锁对象
SELECT * FROM V$LOCKED_OBJECT WHERE ORACLE_USERNAME= 'USERNAME';
-- 查看被锁对象
SELECT v.sid,v.SERIAL#,v.USERNAME,v.ACTION FROM v$session v WHERE v.sid IN (SELECT session_id FROM v$locked_object WHERE ORACLE_USERNAME= 'USERNAME')
</code></pre>

<pre><code class="language-sql">-- 杀死会话： SID,SERIAL# 由上个语句查出
ALTER SYSTEM KILL SESSION 'SID,SERIAL#';  
</code></pre>

<h2 id="超过最大进程数">超过最大进程数</h2>

<p>今天碰到一个问题，登陆不上数据库了，登陆时报错：<code>ORA-00020: maximum number of processes (150) exceeded</code>。这意思是很明显，就是超过最大进程数了，这个可以问题可以通过修改进程数的设置来进行修改，方法如下：</p>

<pre><code class="language-sql">SQL&gt;alter system set processes = 500 scope=SPFILE;
SQL&gt;shutdown immediate
SQL&gt;startup
SQL&gt; show parameter processes
</code></pre>

<p>当然上面的方法只是治标不治本的解决方法。经过观察，发现是由于数据库连接数过多引起的进程数过多，因为每建立一个链接，oracle就会创建一个对应的进程，通过查看 oracle 中的 session 或者 通过查看 oracle 用户的进程可以得到验证，通过下面的命令可以 oracle 链接打开的文件数。</p>

<pre><code class="language-bash">lsof -i:1521
</code></pre>

<p>当时就看到有个 IP 地址与 oracle 机器建立了好多链接，于是得出该IP地址的程序操作后没有及时关闭连接，导致连接不能释放。经与同事沟通后，验证了猜测，修复了程序后恢复正常。</p>

<p>@2015-04-08</p>

<h2 id="查询每个表占用的存储空间">查询每个表占用的存储空间</h2>

<pre><code class="language-sql">select segment_name,sum(bytes)/1024/1024 from user_extents group by segment_name;
</code></pre>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/oracle" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Oracle</a>
   </li>
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">相关阅读</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/post/centos-65-install-oracle-11g-r2/">centos 6.5 安装 oracle 11gR2 及配置Oracle自动启动</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="/" >
    &copy; 2019 不争笔记
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
